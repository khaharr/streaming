<template>
  <div class="container">
    <div class="d-flex justify-content-center text-center p-3 rounded border border-white mt-5 mx-auto">
      <h1>Documentation API</h1>
    </div>
    <div>
      <div class="d-flex justify-content-center">
        <button v-for="(category, index) in categories" :key="index" @click="setActiveCategory(index)" class="btn btn-primary category-button">
          {{ category.name }}
        </button>
      </div>
    </div>
    <section v-for="(api, index) in activeCategory.apis" :key="index">
      <h4 class="text-center text-primary">{{ api.titre }}</h4>
      <h2>{{ api.method }} {{ api.url }}</h2>
      <p><strong>Description:</strong> {{ api.description }}</p>
      <p><strong>Résultat:</strong></p>
      <pre>{{ api.result }}</pre>
      <p><strong>Erreurs:</strong></p>
      <pre>{{ api.errors }}</pre>
    </section>
  </div>
</template>

<script setup lang="ts">
const apis = [
  {
    category: "Fichiers",
    endpoints: [
      {
        titre: "Récupération de fichiers",
        method: 'GET',
        url: '/api/file/[env]/upload/list',
        description: "Récupère les options d'environnement, de zone et de catégories de fichiers disponibles pour le dépôt.",
        result: `{
          "zone": ["za", "zu"],
          "env": ["tipi", "tipi-client"],
          "datacat": {
            "za": {
              "nominoe": {
                "extention": ".xml",
                "format": "nominoe.xml"
              },
              "ics": {
                "extention": ".txt",
                "format": "LISTE_ICS_FRANCE"
              }
            },
            "zu": {
              "helios": {
                "extention": ".xml",
                "format": "TIPI"
              }
            }
          }
        }`,
        errors: `{
          "error": true,
          "message": "Impossible de récupérer les fichiers."
        }`
      },
      {
        titre: "Récuperation de fichiers",
        method: 'POST',
        url: '/api/file/{env}/upload/{zone}/{category}/depot',
        description: "Dépose un fichier dans la catégorie spécifiée pour l'environnement et la zone donnés.",
        result: `{
          "success": true,
          "message": "Fichier déposé avec succès."
        }`,
        errors: `{
          "success": false,
          "message": "Erreur lors du dépôt du fichier."
        }`
      },
      {
        titre: "Téléchargement fichier",
        method: 'GET',
        url: '/api/file/tipi/download/{typedata}/{zone}/listfile',
        description: "Récupère une liste de fichiers disponible pour le téléchargement dans une zone spécifique.",
        result: `{
          "nomfichier": "exemple.log",
          "size": "5.000000 Mo",
          "pathFull": "/path/to/exemple2.log",
          "date": "11/06/2023",
          "zone": "ZA"
        }`,
        errors: `{
          "error": true,
          "message": "Impossible de récupérer la liste des fichiers."
        }`
      },
      {
        titre: "Téléchargement fichier",
        method: 'POST',
        url: '/api/file/tipi/download/{typedata}/download.ts',
        description: "Permet de générer et de télécharger un fichier zip contenant les fichiers sélectionnés.",
        result: `{
          "Content-Type": "application/zip"
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors du téléchargement des fichiers."
        }`
      }
    ]
  },
  {
    category: "Jeux de données",
    endpoints: [
      {
        titre: "Jeux de données",
        method: 'GET',
        url: '/api/dataset/{env}/listeps',
        description: "Récupère une liste EPS avec des options de filtrage.",
        result: `{
          "id": 1,
          "name": "EPS1"
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la récupération de la liste EPS."
        }`
      },
      {
        titre: "Jeux de données",
        method: 'GET',
        url: '/api/dataset/{env}/listrnf',
        description: "Récupère une liste de RNF.",
        result: `{
          "rnf": [
            {
              "numeroclient": "008571",
              "referencerole": "00022399",
              "montant": "1393.50",
              "objet": "-",
              "dtepcepec": "10/01/2025",
              "delaimisenligne": "10/04/2025",
              "statutclientcb": "90",
              "statutclientprelev": "-"
            }
          ]
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la récupération de la liste RNF."
        }`
      },
      {
        titre: "Jeux de données",
        method: 'GET',
        url: '/api/dataset/{env}/listrole',
        description: "Récupère une liste de rôle avec des options de filtrage.",
        result: `{
          "role": [
            {
              "numeroclient": "038712",
              "referencerole": "00159143",
              "montant": "84.35",
              "objet": "2023-EA-00-0000000017474",
              "dtepcepec": "10/01/2025",
              "delaimisenligne": "10/04/2025",
              "statutclientcb": "90",
              "statutclientprelev": "A"
            }
          ]
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la récupération de la liste de rôles."
        }`
      },
      {
        titre: "Jeux de données",
        method: 'GET',
        url: '/api/dataset/{env}/listtitre',
        description: "Récupère une liste de titres avec des options de filtrage.",
        result: `{
          "titre": [
            {
              "numeroclient": "003751",
              "referencerole": "00298959",
              "montant": "29.00",
              "objet": "PARTICIPATION OA 06/2023 SR SOMMIER MARIE JOSE JUIN 2023 RIB :",
              "dtepcepec": "10/01/2025",
              "delaimisenligne": "09/07/2025",
              "statutclientcb": "180",
              "statutclientprelev": "-"
            }
          ]
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la récupération de la liste de titres."
        }`
      },
      {
        titre: "Jeux de données",
        method: 'POST',
        url: '/api/dataset/{env}/updateeps',
        description: "Met à jour les données d'EPS avec des options de filtrage.",
        result: `{
          "status": "success",
          "updated": 50
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la mise à jour des EPS."
        }`
      },
      {
        titre: "Jeux de données",
        method: 'POST',
        url: '/api/dataset/{env}/updaternf',
        description: "Met à jour les données de RNF.",
        result: `{
          "status": "success",
          "updated": 50
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la mise à jour des RNF."
        }`
      },
      {
        titre: "Jeux de données",
        method: 'POST',
        url: '/api/dataset/{env}/updaterole',
        description: "Met à jour les données de rôle avec des options de filtrage.",
        result: `{
          "status": "success",
          "updated": 50
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la mise à jour des rôles."
        }`
      },
      {
        titre: "Jeux de données",
        method: 'POST',
        url: '/api/dataset/{env}/updatetitre',
        description: "Met à jour les données de titre avec des options de filtrage.",
        result: `{
          "status": "success",
          "updated": 50
        }`,
        errors: `{
          "error": true,
          "message": "Erreur lors de la mise à jour des titres."
        }`
      }
    ]
  },
  {
    category: "Suivi de production",
    endpoints: [
      {
        titre: "Suivi de production",
       method: ‘GET’,
url: ‘/api/scheduler/{env}/jobs/suiviExploit’,
description: “Récupère la liste des jobs de suivi d’exploitation.”,
result: { "Application": "ZA_ARCHIVE", "Traitement": "ZA_TB_ARCHIVE", "Statut": "TERMINE", "information": "Traitement termine (0)", "Début d'execution": "11/06/2024 07:00:04", "Fin d'execution": "11/06/2024 07:00:35", "Durée d'execution": "00:00:31" },
errors: { "error": true, "message": "Erreur lors de la récupération du suivi d'exploitation." }
}
]
},
{
category: “Paiement”,
endpoints: [
{
titre: “Paiement”,
method: ‘POST’,
url: ‘/api/paiement{env}’,
description: “Crée un paiement en fonction du type de paiement sélectionné (web service ou URL).”,
result: { "status": "ok", "data": { "url": "http://exemple.com/paiement" } },
errors: { "error": true, "message": "Erreur lors de la création du paiement." }
}
]
}
];

const categories = [
{ name: “fichiers”, apis: apis.find(api => api.category === “Fichiers”)?.endpoints },
{ name: “Jeux de données”, apis: apis.find(api => api.category === “Jeux de données”)?.endpoints },
{ name: “Suivi de production”, apis: apis.find(api => api.category === “Suivi de production”)?.endpoints },
{ name: “Paiement”, apis: apis.find(api => api.category === “Paiement”)?.endpoints },
];

const activeCategoryIndex = ref(0);
const activeCategory = computed(() => categories[activeCategoryIndex.value]);

const setActiveCategory = (index: number) => {
activeCategoryIndex.value = index;
};
